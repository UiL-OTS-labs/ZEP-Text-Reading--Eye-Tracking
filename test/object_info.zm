/******************************************************************************\
FILE:           object_info.zm
AUTHOR:         Theo Veenker <theo.veenker@beexy.nl>
ADAPTED BY:     Maarten Duijndam

DESCRIPTION:

Defines the format of the object information output table.

HISTORY:
2013-01-10 TV   Created.
2016-02-05 MD   Previously only 1 list was saved, now all list are saved.

\******************************************************************************/


// Output table record for object information.
record ObjectInfo
{
    string      id;                     // item id
//    ItemType    type;                 // item type (condition)
    string      completetype;           // item type (condition), prefixed "Q"
                                        //   if stimulus was a question
    int         nlines;                 // number of lines
    int         linenum;                // line number
    int         objnumintext;           // word number in text
    int         nwordsinline;           // number of words in line      
    int         objnuminline;           // object number within line
    int         x;                      // object x (lower-left corner)
    int         y;                      // object y (lower-left corner)
    int         width;                  // object width
    int         height;                 // object height
    int         linelength;             // line length (excludes leading 
                                        //   and/or trailing spaces)
    int         wordlength;             // word length (excludes leading 
                                        //   and/or trailing spaces)
    string      text;                   // object text (excludes any leading 
                                        //   and/or trailing spaces) 
}


// Object information output table.
ObjectInfo[..][..] object_info;


//------------------------------------------------------------------------------


// Appends one row of data to object information output table.
void object_info_append(int listindex, ObjectInfo data)
{
    if (listindex >= object_info.size)
        object_info.size = listindex + 1;

    object_info[listindex].size = object_info[listindex].size + 1;
    object_info[listindex][object_info[listindex].size-1] = data;
}


// Writes object information output table contents to CSV file and clears 
// the table.
void object_info_save()
{
    if (!generate_object_info) return;

    string dir = data_dir() + script_name() + "/obt/";
    int listidx = 0;

    while (listidx < object_info.size) {
        int listnum = listidx + 1;

        // Save table to CSV file (create if non-existent).
        object_info[listidx].save(dir + "objects" + string(listnum) + ".csv", 
            "Object Information: list " + string(listnum));
        object_info[listidx].size = 0;

        listidx++;
    }
}
